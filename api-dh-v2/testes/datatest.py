from flask import Flask, jsonify, request, make_response, json


data_Sql = json.loads(
    '[{"id":1033245,"produtos":["1033245"],"precoProduto":69.99,"filtros":{"genero":["M","F"],"idade":[2,3,4,5,6],"lealdadeProduto":6,"sensibilidadePreco":"0","operador":"AND","un":[],"dna":[]},"regioes":["SP","RJ","DF","GO","MG","TO"],"mecanica":null,"unidadesMaxProduto":null,"grupo":"509","categoria":"100","subcategoria":"109"}]'
)

data_Sql_Modalidade = json.loads(
    '{"audience":[{"id":1033245,"modalidade":"","precoProduto":69.99,"filtros":{"genero":["M","F"],"idade":[2,3,4,5,6],"lealdadeProduto":6,"sensibilidadePreco":"0","operador":"AND","un":[],"dna":[]},"regioes":["SP","RJ","DF","GO","MG","TO"],"mecanica":null,"unidadesMaxProduto":null,"grupo":"509","categoria":"100","subcategoria":"109"}]}'
)

data_Sql_filters = json.loads(
    '[{"id":1033245,"produtos":["1033245"],"precoProduto":69.99,"filtros":{"genero":["M"],"idade":[2,3,6],"lealdadeProduto":6,"sensibilidadePreco":"VPS","operador":"AND","un":[],"dna":[]},"regioes":["SP","RJ","DF","GO","MG","TO"],"mecanica":null,"unidadesMaxProduto":null,"grupo":"509","categoria":"100","subcategoria":"109"}]'
)
data_Sql_filterIndustriaIndexInfo = json.loads(
    '{"str_l20": "01011403040", "str_l21": "01011403", "units_per_visit": "1.3250430817160446", "min_perc_disc": "20", "weight_flag": "False", "is_alcohol": "False", "un_code": "01011403040"}'
)

data_Sql_filterIndustriaIModalidade = json.loads(
  '{"tipotarget": "PLU", "produto": ["3327760","1164638"], "familia": "", "subgrupo": "007", "grupo": "592", "subcategoria": "104", "categoria": "101","departamento":"010","vendor_class_code":"0000","vendor_code":"0000000023473"}')


data_sql_filter_dna = json.loads(
    '[{"id":1033245,"produtos":["1033245"],"precoProduto":22.79,"filtros":{"genero":["M","F"],"idade":[1,2,3,4,5,6],"lealdadeProduto":6,"sensibilidadePreco":"0","operador":"AND","un":[],"dna":[{"codigo":4,"descricao":"Compram uma alta variedade de produtos de beleza."}],"operadorDna":"AND"},"regioes":["SP","RJ","DF","GO","MG","TO"],"mecanica":null,"unidadesMaxProduto":null,"grupo":"40","categoria":"1400","subcategoria":"1403"}]')

data_Sql_filterIndustria_lealdade1_response = "select count(*) from t_audience_l21_01011403  where prod_code in ('1033245') and is_loyal_a = true  AND prsn_age_range_code in (2,3,4,5,6)   AND prsn_address_state_prov_code in (26,19,7,9,11,27)"
data_Sql_filterIndustria_lealdade2_response = "select count(*) from t_audience_l21_01011403  where prod_code in ('1033245') and is_loyal_a = false  AND prsn_age_range_code in (2,3,4,5,6)   AND prsn_address_state_prov_code in (26,19,7,9,11,27)"
data_Sql_filterIndustria_lealdade3_response = "select (select count(*) from un_filters where un_01011403040 = 1 and prsn_age_range_code in (2,3,4,5,6) and prsn_address_state_prov_code in (26,19,7,9,11,27) ) - (select coalesce(count(distinct t_audience_l21_01011403.prsn_id),0) as audience from t_audience_l21_01011403 where prod_code in ('1033245') and prsn_age_range_code in (2,3,4,5,6) and prsn_address_state_prov_code in (26,19,7,9,11,27) )"
data_Sql_filterIndustria_lealdade4_response = "select count (*) from un_filters  where un_01011403040 = 0   AND prsn_age_range_code in (2,3,4,5,6)   AND prsn_address_state_prov_code in (26,19,7,9,11,27)"
data_Sql_filterIndustria_lealdade5_response = "select ( (select count(*) from un_filters where prsn_age_range_code in (2,3,4,5,6) and prsn_address_state_prov_code in (26,19,7,9,11,27)) - ( select count(*) from ( select u.prsn_id from t_audience_l21_01010104 u inner join product_filter prd on prd.prod_code = u.prod_code where 1=1 and prsn_age_range_code in (2,3,4,5,6) and prsn_address_state_prov_code in (26,19,7,9,11,27) ) as t ) ) as c"
data_Sql_filterIndustria_lealdade6_response = "select count(distinct t.prsn_id) from ( select u.prsn_id from t_audience_l21_01010104 u inner join product_filter prd on prd.prod_code = u.prod_code where is_recovery_candidate = false and is_loyal_b = true and prsn_age_range_code in (2,3,4,5,6) and prsn_address_state_prov_code in (26,19,7,9,11,27) ) as t;"
data_Sql_filterIndustria_lealdade7_response = "select count(distinct t.prsn_id) from ( select u.prsn_id from t_audience_l21_01010104 u inner join product_filter prd on prd.prod_code = u.prod_code where is_recovery_candidate = false and is_loyal_b = false and prsn_age_range_code in (2,3,4,5,6) and prsn_address_state_prov_code in (26,19,7,9,11,27) ) as t;"
data_Sql_filterIndustria_lealdade10_response = "select (select sum(qty) from ( select sum(cast(prsn_qty as bigint)) qty from prod_new_prsn_count_filter where prod_comml_code in ('010101104592') and prsn_age_range_code in (2,3,4,5,6) and loyalty_program_code in ('3') and prsn_address_state_prov_code in (26,19,7,9,11,27) ) as t ) - (select count(distinct prsn_id) from ( select u.prsn_id from t_audience_l21_01010104 u inner join product_filter prd on prd.prod_code = u.prod_code where is_recovery_candidate = false and prsn_age_range_code in (2,3,4,5,6) and prsn_address_state_prov_code in (26,19,7,9,11,27) ) as d)"
data_Sql_filterIndustria_lealdade20_response = "select count(distinct t.prsn_id) from ( select u.prsn_id from t_audience_l21_01010104 u inner join product_filter prd on prd.prod_code = u.prod_code where 1=1 and is_recovery_candidate = true and prsn_age_range_code in (2,3,4,5,6) and prsn_address_state_prov_code in (26,19,7,9,11,27) ) as t;"
data_Sql_filterIndustria_lealdade5_un_response = "select count(distinct(u.prsn_id)) from un_filters u left join ( select u.prsn_id from t_audience_l21_01010104 u inner join product_filter prd on prd.prod_code = u.prod_code where 1=1 and prsn_age_range_code in (2,3,4,5,6) and prsn_address_state_prov_code in (26,19,7,9,11,27) ) aud on (u.prsn_id = aud.prsn_id) where aud.prsn_id is null and ( un_01011403034002 = 1 and un_01011403040 = 1 ) and u.prsn_age_range_code in (2,3,4,5,6) and u.prsn_address_state_prov_code in (26,19,7,9,11,27)"


data_Sql_filterIndustria_lealdade1_filters_response = "select count(*) from t_audience_l21_01011403  where prod_code in ('1033245') and is_loyal_a = true  AND prsn_gender_code in (1) AND prsn_age_range_code in (2,3,6) AND prsn_price_sens_code in (4)   AND prsn_address_state_prov_code in (26,19,7,9,11,27)"
data_Sql_filterIndustria_dna_lealdade1_response = "select count(*) from t_audience_l21_01011403 inner join personas on t_audience_l21_01011403.prsn_id = personas.prsn_id AND (seg_value_beleza = 1) where prod_code in ('1033245') and is_loyal_a = true    AND prsn_address_state_prov_code in (26,19,7,9,11,27)"
data_Sql_filterIndustria_dna_lealdade2_response="select count(*) from t_audience_l21_01011403 inner join personas on t_audience_l21_01011403.prsn_id = personas.prsn_id AND (seg_value_beleza = 1) where prod_code in ('1033245') and is_loyal_a = false    AND prsn_address_state_prov_code in (26,19,7,9,11,27)"
data_Sql_filterIndustria_dna_lealdade3_response="select (select count(*) from un_filters inner join personas on un_filters.prsn_id = personas.prsn_id and (seg_value_beleza = 1) where un_01011403040 = 1 and prsn_address_state_prov_code in (26,19,7,9,11,27) ) - (select coalesce(count(distinct t_audience_l21_01011403.prsn_id),0) as audience from t_audience_l21_01011403 inner join personas on t_audience_l21_01011403.prsn_id = personas.prsn_id and (seg_value_beleza = 1) where prod_code in ('1033245') and prsn_address_state_prov_code in (26,19,7,9,11,27) )"
data_Sql_filterIndustria_dna_lealdade4_response="select count (*) from un_filters inner join personas on un_filters.prsn_id = personas.prsn_id AND (seg_value_beleza = 1) where un_01011403040 = 0 AND prsn_address_state_prov_code in (26,19,7,9,11,27)"
data_Sql_filterIndustria_dna_lealdade5_response="select count(distinct(u.prsn_id)) from un_filters u inner join personas on u.prsn_id = personas.prsn_id and (seg_value_beleza = 1) left join ( select u.prsn_id from t_audience_l21_01010104 u inner join product_filter prd on prd.prod_code = u.prod_code where 1=1 and prsn_age_range_code in (2,3,4,5,6) and prsn_address_state_prov_code in (26,19,7,9,11,27) ) aud on (u.prsn_id = aud.prsn_id) where aud.prsn_id is null and u.prsn_age_range_code in (2,3,4,5,6) and u.prsn_address_state_prov_code in (26,19,7,9,11,27)"
data_Sql_filterIndustria_dna_lealdade6_response= "select count(distinct t.prsn_id) from ( select u.prsn_id from t_audience_l21_01010104 u inner join personas on u.prsn_id = personas.prsn_id and (seg_value_beleza = 1) inner join product_filter prd on prd.prod_code = u.prod_code where is_recovery_candidate = false and is_loyal_b = true and prsn_age_range_code in (2,3,4,5,6) and prsn_address_state_prov_code in (26,19,7,9,11,27) ) as t;"
data_Sql_filterIndustria_dna_lealdade7_response="select count(distinct t.prsn_id) from ( select u.prsn_id from t_audience_l21_01010104 u inner join personas on u.prsn_id = personas.prsn_id and (seg_value_beleza = 1) inner join product_filter prd on prd.prod_code = u.prod_code where is_recovery_candidate = false and is_loyal_b = false and prsn_age_range_code in (2,3,4,5,6) and prsn_address_state_prov_code in (26,19,7,9,11,27) ) as t;"
data_Sql_filterIndustria_dna_lealdade10_response="select (select sum(qty) from ( select sum(cast(prsn_qty as bigint)) qty from prod_new_prsn_count_filter where prod_comml_code in ('010101104592') and prsn_age_range_code in (2,3,4,5,6) and loyalty_program_code in ('3') and prsn_address_state_prov_code in (26,19,7,9,11,27) ) as t ) - (select count(distinct prsn_id) from ( select u.prsn_id from t_audience_l21_01010104 u inner join personas on u.prsn_id = personas.prsn_id and (seg_value_beleza = 1) inner join product_filter prd on prd.prod_code = u.prod_code where is_recovery_candidate = false and prsn_age_range_code in (2,3,4,5,6) and prsn_address_state_prov_code in (26,19,7,9,11,27) ) as d)"
data_Sql_filterIndustria_dna_lealdade20_response="select count(distinct t.prsn_id) from ( select u.prsn_id from t_audience_l21_01010104 u inner join personas on u.prsn_id = personas.prsn_id and (seg_value_beleza = 1) inner join product_filter prd on prd.prod_code = u.prod_code where 1=1 and is_recovery_candidate = true and prsn_age_range_code in (2,3,4,5,6) and prsn_address_state_prov_code in (26,19,7,9,11,27) ) as t;"
data_Sql_filterIndustria_dna_lealdade5_un_response="select count(distinct(u.prsn_id)) from un_filters u inner join personas on u.prsn_id = personas.prsn_id and (seg_value_beleza = 1) left join ( select u.prsn_id from t_audience_l21_01010104 u inner join product_filter prd on prd.prod_code = u.prod_code where 1=1 and prsn_age_range_code in (2,3,4,5,6) and prsn_address_state_prov_code in (26,19,7,9,11,27) ) aud on (u.prsn_id = aud.prsn_id) where aud.prsn_id is null and ( un_01011403034002 = 1 and un_01011403040 = 1 ) and u.prsn_age_range_code in (2,3,4,5,6) and u.prsn_address_state_prov_code in (26,19,7,9,11,27)"

dna = json.loads('[{"codigo":4,"descricao":"Compram uma alta variedade de produtos de beleza."}]')